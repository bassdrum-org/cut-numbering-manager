# カット番号管理システム 実装計画

## 1. プロジェクト概要

### 目的
アニメ制作現場でのカット番号管理を自動化し、制作効率を向上させるシステムを開発する。特にプリビズ（映像の仮組み）や3Dアニメ制作において、カットごとのデータ整理を容易にし、制作データの整合性を保つことを目指す。

### 想定ユーザー
- アニメ制作のプリビズ担当者
- 3DCGチームのディレクター／制作進行
- 編集・演出スタッフ（カット管理の取りまとめ役）

### 主な機能
- OBSとのOSC連携によるカット番号の自動管理
- ファイル命名規則の自動適用
- 録画の開始・終了制御
- バージョン管理の自動化

## 2. 技術スタック

### 開発言語・フレームワーク
- **Python**: メイン開発言語
- **Qt**: GUIフレームワーク（PyQt5またはPySide6を使用）
- **OSC (Open Sound Control)**: OBSとの通信プロトコル

### 依存ライブラリ
- **python-osc**: OSCプロトコルの実装
- **PyQt5/PySide6**: GUI実装
- **python-dotenv**: 設定管理（IPアドレス、ポート番号など）

### 開発ツール
- **Git**: バージョン管理
- **Poetry/Pipenv**: 依存関係管理
- **PyInstaller/cx_Freeze**: 実行可能ファイル作成（配布用）

## 3. システムアーキテクチャ

### コンポーネント構成
1. **GUIモジュール**
   - メインウィンドウ管理
   - 入力フォーム（パート名、シーン名、バージョン名など）
   - 録画制御ボタン
   - ファイル名プレビュー表示

2. **OSC通信モジュール**
   - OBSとの通信管理
   - OSCメッセージの送受信
   - 死活監視機能（オプション）

3. **カット番号管理モジュール**
   - カット番号の自動割り振り
   - バージョン管理
   - ファイル命名規則の適用

4. **設定管理モジュール**
   - IPアドレス・ポート設定
   - ファイル保存先設定
   - ユーザー設定の保存・読み込み

### データフロー
1. ユーザーがGUIからパート名、シーン名、初期バージョンを入力
2. 「REC」ボタンを押すとOSCを通じてOBSの録画を開始
3. シーン切り替わり検出時にカット番号を自動インクリメント
4. 録画終了時にファイル名を自動生成し、次のバージョン番号を準備

## 4. 機能詳細

### OBS連携機能
- **OSC通信設定**
  - IPアドレス・ポート番号の設定UI
  - 通信テスト機能
  - 死活監視機能（オプション）

- **録画制御**
  - 録画開始/停止コマンドの送信
  - 録画状態の監視

- **シーン切り替え検出**
  - OBSからのシーン切り替え通知の受信
  - カット番号の自動インクリメント

### ファイル命名管理
- **命名規則**: `{パート名}_{シーン名}_{カット番号}_{バージョン名}`
- **自動フォーマット機能**
  - 入力完了時のリアルタイムプレビュー
  - 特殊文字の自動置換（ファイル名に使用できない文字の処理）

- **バージョン管理**
  - 録画終了時のバージョン自動更新
  - バージョン履歴の管理

### ユーザーインターフェース
- **メイン画面**
  - パート名入力フィールド
  - シーン名入力フィールド
  - カット番号表示（自動管理・手動調整可能）
  - バージョン名入力フィールド
  - ファイル名プレビュー表示
  - 録画開始/停止ボタン

- **設定画面**
  - OSC通信設定（IPアドレス、ポート番号）
  - ファイル保存先設定
  - その他の環境設定

## 5. 実装計画

### フェーズ1: 基本設計・環境構築
- プロジェクト構成の決定
- 依存ライブラリの選定
- 開発環境のセットアップ
- 基本的なクラス設計

### フェーズ2: コア機能実装
- OSC通信モジュールの実装
- カット番号管理ロジックの実装
- ファイル命名規則の実装
- 設定管理機能の実装

### フェーズ3: GUI実装
- メイン画面のレイアウト設計
- 入力フォームの実装
- ファイル名プレビュー機能の実装
- 録画制御ボタンの実装

### フェーズ4: 統合・テスト
- 各モジュールの統合
- OBSとの連携テスト
- ユーザーフィードバックの収集
- バグ修正・機能調整

### フェーズ5: パッケージング・配布
- 実行可能ファイルの作成
- インストーラーの作成（必要に応じて）
- ドキュメント作成
- 配布準備

## 6. ディレクトリ構造

```
cut-numbering-manager/
├── src/
│   ├── __init__.py
│   ├── main.py              # アプリケーションのエントリーポイント
│   ├── gui/
│   │   ├── __init__.py
│   │   ├── main_window.py   # メインウィンドウ
│   │   ├── settings_dialog.py # 設定ダイアログ
│   │   └── resources/       # アイコン等のリソース
│   ├── core/
│   │   ├── __init__.py
│   │   ├── cut_manager.py   # カット番号管理
│   │   ├── file_namer.py    # ファイル命名
│   │   └── version_manager.py # バージョン管理
│   ├── osc/
│   │   ├── __init__.py
│   │   ├── client.py        # OSC送信
│   │   ├── server.py        # OSC受信
│   │   └── monitor.py       # 死活監視
│   └── config/
│       ├── __init__.py
│       └── settings.py      # 設定管理
├── tests/                   # テストコード
├── resources/               # リソースファイル
├── docs/                    # ドキュメント
├── pyproject.toml           # 依存関係管理
├── README.md                # プロジェクト説明
└── LICENSE                  # ライセンス
```

## 7. 参考資料

- **TouchDesignerで作成された既存アプリ**
  - https://drive.google.com/drive/folders/1mDHQXf8ptGGTjeOY0xwTfkW0jLwYSyER

- **OBSプラグイン**
  - https://github.com/jshea2/OSC-for-OBS

- **実際のOBS録画映像サンプル**
  - https://drive.google.com/drive/folders/1b5XNSp-gbvYxeItBzdlAuoNMnvjVnnUJ

## 8. 今後の拡張可能性

- **複数OBSインスタンスの管理**
  - 複数カメラからの同時録画対応

- **クラウド連携**
  - 録画ファイルの自動アップロード
  - チーム間での共有機能

- **高度な自動化**
  - AIによるシーン検出
  - 音声認識によるタイムコード付与

- **他ツールとの連携**
  - 編集ソフトへの直接エクスポート
  - プロジェクト管理ツールとの連携
